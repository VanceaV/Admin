node {
   stage("Code Check out"){
       git 'https://github.com/VanceaV/llmmss.git'
   }
   stage("Compile-Package"){
       sh script: 'mvn clean install'
   }
   
   
   
   
    dir('target') {
        stage("Archive"){
         archiveArtifacts '*.jar'
        }
    }
   
   
   stage('Upload to S3') {

        dir('/var/lib/jenkins/workspace/PiplineJob_1'){

            pwd(); //Log current directory

            withAWS(region:'us-east-1',credentials:'JenkinsCred') {

                 def identity=awsIdentity();//Log AWS credentials

                // Upload files from working directory 'dist' in your project workspace
                s3Upload(bucket:"vladimirvancea", workingDir:'target', includePathPattern:'**/*.jar');
            }

        };
    }
    
    
    stage('JenkinsToAWSDeploy'){
    
    
    
    withAWS(region:'us-east-1',credentials:'JenkinsCred') {

                 def identity=awsIdentity();//Log AWS credentials
                 
                 
                 sh label: '', script: 'aws --region us-east-1 cloudformation create-stack --stack-name JenkinsToAWSDeploy --template-url https://s3.amazonaws.com/vladimirvancea/Temp.yml --parameters ParameterKey=KeyName,ParameterValue=ubuntuKey ParameterKey=VPCSelection,ParameterValue=Default'

                
            }

    
    
    
    
    }
    
    
}
